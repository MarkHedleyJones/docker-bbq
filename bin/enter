#!/usr/bin/env bash

image=NULL

# Locate Dockerfile to determine image name
path=$(pwd)
while [[ ${path} != "/" ]]; do
    if [[ -f ${path}/Dockerfile ]]; then
        image=$(basename ${path})
        break
    fi
    path=$(dirname ${path})
done

if [[ ${image} == NULL ]]; then
    echo "Couldnt find a Dockerfile this or any parent directory - aborting!"
    exit 1
fi

local_workspace="${path}/workspace"
image_workspace="/ws"

docker_command="/bin/bash"
if [[ ${#} -gt 0 ]]; then
    if [[ -f ${local_workspace}/${1} ]]; then
        docker_command="/bin/bash -c \"${image_workspace}/$@\""
    else
        docker_command="/bin/bash -c \"$@\""
    fi
fi

docker_args_workdir="--workdir=${image_workspace} "

docker exec \
    --interactive \
    --tty \
    ${docker_args_workdir} \
    ${image} \
    ${docker_command}
